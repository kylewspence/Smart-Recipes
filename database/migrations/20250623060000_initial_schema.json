{
    "version": "20250623060000_initial_schema",
    "name": "Initial Schema Setup",
    "up": "-- Reset schema\nSET client_min_messages TO warning;\nDROP SCHEMA IF EXISTS \"public\" CASCADE;\nCREATE SCHEMA \"public\";\n\n-- Users table\nCREATE TABLE \"users\" (\n  \"userId\"       SERIAL PRIMARY KEY,\n  \"email\"        TEXT UNIQUE NOT NULL,\n  \"name\"         TEXT NOT NULL,\n  \"createdAt\"    TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"updatedAt\"    TIMESTAMPTZ(6) NOT NULL DEFAULT NOW()\n);\n\n-- Ingredient catalog\nCREATE TABLE \"ingredients\" (\n  \"ingredientId\" SERIAL PRIMARY KEY,\n  \"name\"         TEXT UNIQUE NOT NULL,\n  \"category\"     TEXT,\n  \"createdAt\"    TIMESTAMPTZ(6) NOT NULL DEFAULT NOW()\n);\n\n-- User-specific preferences (normalized)\nCREATE TABLE \"userIngredientPreferences\" (\n  \"id\"           SERIAL PRIMARY KEY,\n  \"userId\"       INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"ingredientId\" INTEGER NOT NULL REFERENCES \"ingredients\"(\"ingredientId\") ON DELETE CASCADE,\n  \"preference\"   TEXT NOT NULL CHECK (\"preference\" IN ('like', 'dislike', 'stretch')),\n  UNIQUE (\"userId\", \"ingredientId\")\n);\n\n-- Broader user dietary preferences\nCREATE TABLE \"userPreferences\" (\n  \"preferenceId\"       SERIAL PRIMARY KEY,\n  \"userId\"             INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"dietaryRestrictions\" TEXT[],\n  \"allergies\"          TEXT[],\n  \"cuisinePreferences\" TEXT[],\n  \"spiceLevel\"         TEXT CHECK (\"spiceLevel\" IN ('mild', 'medium', 'hot')),\n  \"maxCookingTime\"     INTEGER,\n  \"servingSize\"        INTEGER DEFAULT 4,\n  \"createdAt\"          TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"updatedAt\"          TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  UNIQUE (\"userId\")\n);\n\n-- AI-generated and saved recipes\nCREATE TABLE \"recipes\" (\n  \"recipeId\"       SERIAL PRIMARY KEY,\n  \"userId\"         INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"title\"          TEXT NOT NULL,\n  \"description\"    TEXT,\n  \"instructions\"   TEXT NOT NULL,\n  \"cookingTime\"    INTEGER,\n  \"prepTime\"       INTEGER,\n  \"servings\"       INTEGER,\n  \"cuisine\"        TEXT,\n  \"difficulty\"     TEXT CHECK (\"difficulty\" IN ('easy', 'medium', 'hard')),\n  \"spiceLevel\"     TEXT CHECK (\"spiceLevel\" IN ('mild', 'medium', 'hot')),\n  \"isFavorite\"     BOOLEAN DEFAULT FALSE,\n  \"isGenerated\"    BOOLEAN DEFAULT TRUE,\n  \"generatedPrompt\" TEXT,\n  \"createdAt\"      TIMESTAMPTZ(6) NOT NULL DEFAULT NOW()\n);\n\n-- Recipe ratings and reviews\nCREATE TABLE \"recipeRatings\" (\n  \"id\"         SERIAL PRIMARY KEY,\n  \"recipeId\"   INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"userId\"     INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"rating\"     INTEGER NOT NULL CHECK (\"rating\" >= 1 AND \"rating\" <= 5),\n  \"review\"     TEXT,\n  \"createdAt\"  TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"updatedAt\"  TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  UNIQUE (\"recipeId\", \"userId\")\n);\n\n-- Recipe collections (user-created groups of recipes)\nCREATE TABLE \"recipeCollections\" (\n  \"collectionId\" SERIAL PRIMARY KEY,\n  \"userId\"       INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"name\"         TEXT NOT NULL,\n  \"description\"  TEXT,\n  \"isPublic\"     BOOLEAN DEFAULT FALSE,\n  \"createdAt\"    TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"updatedAt\"    TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  UNIQUE (\"userId\", \"name\")\n);\n\n-- Many-to-many: recipes in collections\nCREATE TABLE \"collectionRecipes\" (\n  \"collectionId\" INTEGER NOT NULL REFERENCES \"recipeCollections\"(\"collectionId\") ON DELETE CASCADE,\n  \"recipeId\"     INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"addedAt\"      TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  PRIMARY KEY (\"collectionId\", \"recipeId\")\n);\n\n-- Many-to-many relationship: ingredients in a recipe\nCREATE TABLE \"recipeIngredients\" (\n  \"recipeId\"     INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"ingredientId\" INTEGER NOT NULL REFERENCES \"ingredients\"(\"ingredientId\"),\n  \"quantity\"     TEXT,\n  PRIMARY KEY (\"recipeId\", \"ingredientId\")\n);\n\n-- Recipe tags (e.g. 'low-carb', 'quick', 'comfort food')\nCREATE TABLE \"recipeTags\" (\n  \"tagId\"     SERIAL PRIMARY KEY,\n  \"recipeId\"  INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"tag\"       TEXT NOT NULL\n);\n\n-- Fridge inventory: what's on hand\nCREATE TABLE \"fridgeItems\" (\n  \"itemId\"       SERIAL PRIMARY KEY,\n  \"userId\"       INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"ingredientId\" INTEGER NOT NULL REFERENCES \"ingredients\"(\"ingredientId\"),\n  \"quantity\"     TEXT,\n  \"expiresOn\"    DATE\n);\n\n-- Saved/favorited recipes\nCREATE TABLE \"savedRecipes\" (\n  \"id\"        SERIAL PRIMARY KEY,\n  \"userId\"    INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"recipeId\"  INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"savedAt\"   TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  UNIQUE (\"userId\", \"recipeId\")\n);\n\n-- Indexes for performance\nCREATE INDEX ON \"recipes\" (\"userId\");\nCREATE INDEX ON \"recipes\" (\"cuisine\");\nCREATE INDEX ON \"recipes\" (\"difficulty\");\nCREATE INDEX ON \"recipes\" (\"cookingTime\");\nCREATE INDEX ON \"recipes\" (\"isFavorite\");\nCREATE INDEX ON \"recipeRatings\" (\"recipeId\");\nCREATE INDEX ON \"recipeRatings\" (\"userId\");\nCREATE INDEX ON \"recipeTags\" (\"tag\");\nCREATE INDEX ON \"recipeTags\" (\"recipeId\");\nCREATE INDEX ON \"userIngredientPreferences\" (\"userId\", \"preference\");\nCREATE INDEX ON \"fridgeItems\" (\"userId\");\nCREATE INDEX ON \"savedRecipes\" (\"userId\");\nCREATE INDEX ON \"collectionRecipes\" (\"collectionId\");\nCREATE INDEX ON \"recipeCollections\" (\"userId\", \"isPublic\");",
    "down": "-- Drop all tables and reset schema\nDROP SCHEMA \"public\" CASCADE;\nCREATE SCHEMA \"public\";",
    "timestamp": "2025-06-23T06:00:00.000Z",
    "checksum": "aW5pdGlhbF9zY2hlbWFfY2hlY2tzdW0="
}