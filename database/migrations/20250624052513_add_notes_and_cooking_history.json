{
  "version": "20250624052513_add_notes_and_cooking_history",
  "name": "add_notes_and_cooking_history",
  "up": "-- Personal recipe notes (user-specific notes on recipes)\nCREATE TABLE IF NOT EXISTS \"recipeNotes\" (\n  \"noteId\"     SERIAL PRIMARY KEY,\n  \"recipeId\"   INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"userId\"     INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"note\"       TEXT NOT NULL,\n  \"noteType\"   TEXT NOT NULL CHECK (\"noteType\" IN ('personal', 'modification', 'tip', 'review')) DEFAULT 'personal',\n  \"isPrivate\"  BOOLEAN DEFAULT TRUE,\n  \"createdAt\"  TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"updatedAt\"  TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  UNIQUE (\"recipeId\", \"userId\", \"noteType\")\n);\n\n-- Cooking history tracking (when users cook recipes)\nCREATE TABLE IF NOT EXISTS \"cookingHistory\" (\n  \"historyId\"    SERIAL PRIMARY KEY,\n  \"recipeId\"     INTEGER NOT NULL REFERENCES \"recipes\"(\"recipeId\") ON DELETE CASCADE,\n  \"userId\"       INTEGER NOT NULL REFERENCES \"users\"(\"userId\") ON DELETE CASCADE,\n  \"cookedAt\"     TIMESTAMPTZ(6) NOT NULL DEFAULT NOW(),\n  \"rating\"       INTEGER CHECK (\"rating\" >= 1 AND \"rating\" <= 5),\n  \"notes\"        TEXT,\n  \"modifications\" JSONB,\n  \"cookingTime\"  INTEGER,\n  \"servings\"     INTEGER,\n  \"success\"      BOOLEAN DEFAULT TRUE,\n  \"wouldCookAgain\" BOOLEAN\n);\n\n-- Create indexes for better performance\nCREATE INDEX IF NOT EXISTS \"idx_recipe_notes_recipe_user\" ON \"recipeNotes\" (\"recipeId\", \"userId\");\nCREATE INDEX IF NOT EXISTS \"idx_recipe_notes_type\" ON \"recipeNotes\" (\"noteType\");\nCREATE INDEX IF NOT EXISTS \"idx_cooking_history_recipe\" ON \"cookingHistory\" (\"recipeId\");\nCREATE INDEX IF NOT EXISTS \"idx_cooking_history_user\" ON \"cookingHistory\" (\"userId\");\nCREATE INDEX IF NOT EXISTS \"idx_cooking_history_cooked_at\" ON \"cookingHistory\" (\"cookedAt\" DESC);",
  "down": "-- Drop indexes\nDROP INDEX IF EXISTS \"idx_cooking_history_cooked_at\";\nDROP INDEX IF EXISTS \"idx_cooking_history_user\";\nDROP INDEX IF EXISTS \"idx_cooking_history_recipe\";\nDROP INDEX IF EXISTS \"idx_recipe_notes_type\";\nDROP INDEX IF EXISTS \"idx_recipe_notes_recipe_user\";\n\n-- Drop tables\nDROP TABLE IF EXISTS \"cookingHistory\";\nDROP TABLE IF EXISTS \"recipeNotes\";",
  "timestamp": "2025-06-24T05:25:13.262Z",
  "checksum": "updated_checksum_for_notes_and_cooking_history"
}